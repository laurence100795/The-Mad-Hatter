<h1>Project overview </h1>
<p>I’m creating an ecommerce website for hats for my final project. My sister has finished University and wants me to create her a website for her start up. So I will be creating a website with a fully functioning shopping system with accounts, product selection features, administration systems and various other things. It will be similar to the practise project but I’m planning on implementing different features to the change it up such as a discount code for purchase as well as social media authentication. I will likely look into further features but at this point in time that’s all I have found and like.</p>
<hr>
<h2>Initial Design</h2>
<p>I and my sister went of various colour schemes for the site do see which she wanted for her brand and eventually we went for dark grey and black for the background, navigation and footer, purple and white for text. The font we went for is called Nunito she liked the simple clean look it brought so that will be the main and possibly only font we use on the site. </p>
<hr>
<h3>Wireframe</h3>
<p>After we decided the colour scheme and font for the website I moved to Balsamiq to create a design for the site. Using the features in Balsamiq we easier came up with a design she liked working on the Navigation bar and Footer. I used it the colour features on the product so we could match it up as she would like. They will be attached to the project in a folder called “Initial Design”. The site is likely to change from these wireframes as time goes on but for the time being this is the designs we started with.</p>
<hr>
<h2>Navigation Bar</h2>
<p>The navigation bar is very similar to the one in the practise project. I used that as a template and my client saw it and stated she liked the way it looked so I have kept it the way it is for now. With the colour scheme in place the dark grey containers and the purple text it looks good but there is likely to be some adjustments to them in the future as the contrast between the colours isn’t that strong and could be hard to read and cause I strain. The categories are set to different hat styles with different sub categories from them. I used the different template technique used in the practise project for the computer to mobile navigation bar design. I prefer this as you can segment different parts of the navigation bar into different HTML files which makes it neater and easier to work with. I changed the hover effect on all interactive features on the navigation bar was changed so when you hover over something it goes to a darker shade of purple instead of the lighter default colour. I might increase the colour of the purple to a lighter shade regarding the default and the hover so it has a better contrast with the dark background colours.</p>
<hr>
<h3>Navigation options</h3>
<p>The navigation bar options are split into 5 columns which are all products, beanies, hats, caps and about page. All products is a standard navigation link with no dropdown which loads all the products stored inside the app. Beanies, hats and caps are all dropdown links which contain an all products link for that category as well as sub categories for each product type. They will also include a category for sort by rating and price. The final category doesn’t have anything to do with the products app it’s just a standard page which explains information on the owner of site and more about them. The top of the navigation bar contains the logo as a link to the homepage on the right, a functioning search bar in the centre and the accounts and shopping bag option on the left on the top navigation bar. The accounts and shopping bag are both drop downs with the accounts showing login and register if not authenticated when authenticated shows my profile, orders and logout. When authenticated as a super user it will also display product management. This format is achieved via a simple if statement using standard python and build in Django logic. The navigation for this is managed by the products view. It works the same way as in the practise project but I was trying to think of a way of doing it different but from what I know and have been taught this is the best way to do it so I kept it. </p>
<hr>
<h2>Footer</h2>
<p>I wanted a footer for this website to include a link to my GitHub and put a copyright mark onto it stating I’m the creator of the website as well as a report issues section so if anything goes wrong with the site that the customers run into, they can report this to the owner so it can be reviewed. The first thing I needed to figure out was the positioning of the footer making it stick to the bottom of the website for any screen size. The way this was done was by having the html and body container set to 100% height with a container surrounding the page content the minimum height of 100% the footer container below set to position relative. With all this in place it footer will stay firmly positioned at the bottom of the page for any device. In the footer I set a div with the class row and justify content between so when I place the 2 containers in the bottom for each section one will stick to the left and one will stick to the right when on a large screen but the containers will be full size on top of each other for any screen sizes less. I kept the same colour scheme as everything else on the site set both the a-tag text increase in font weight and colour of the text change to white when you hover over it. </p>
<hr>
<h2>Home Page</h2>
<p>When we discussed what we wanted to happen on the homepage we she wanted it simple and active like the project site created previous as I used this as an example of what can be done. I suggested a difference which is to have a constant changing background rotating between 4 different pictures giving it a simple yet eye catching feature from when you first open the website. So I picked out 4 placeholder photos which will be replaced once she has taken some pictures of her own products. I then set up the discount promotion for the home page. I made it a black container with a white text so that it starts out with a strong contrast. The font is large and bold really designed to catch the eyes of the customer. After completing the promo box I decided to add a button in which on click stores the promo code in your copy. I looked into how to do this and tried doing it for myself but I could only get it to copy something within a textbox and the text targeting the span just failed. I looked it up and found code on Stack Overflow which showed me how to do it and then I was able to implement this feature into the website. I figured if there was just a button you need to press to get this get the promo code it would be more appealing to the customer compared to them having to copy it themselves or remembering it. The button is a white background with black text and on hover it transitions to white text with the purple themed colour as the background for the button. For the background and the interactive copy button I placed the javascript in a dedicated javascript file which is attached to the homepage and is solely used on the homepage. I will do this for each and every page throughout the website as this is a very tidy way of building a website and functional as you only need to load the javascript required for that page instead of for the whole site which could cause speed issues.</p>
<hr>
<h2>Email Submission Page</h2>
<p>The customer wanted an email submissions page for the customer so they can easily contact the support for any issues such as refunds, account issues and possible website malfunctions. I put the link to this in the footer so this page can be easily accessed from anyone on the site. The page is very simple it is I title with text below explain the page with 3 boxes, an email box, selection box and a text area with a trailing button to submit the email. The reasoning for this format is an email which will be taken as the sender in the email the selection box for a subject and the text area for the context of email. With this the HTML side of the page is complete, the part that handles this process is a simple view which will be explained below.</p>
<hr>
<h3>Email View</h3>
<p>The email view is very simple, it starts to check if there’s a post request. With this I take the subject, message and sender from the post request then I call the built-in send mail function were I put in this order subject, message, email and the Default From email which is taken from main project settings. From what I’m aware the order is important for example the two email addresses, depending on the order depends which one is the sender or recipient. After that there is a confirmation message stating it’s been submitted then I return the request to email homepage finishing the process.</p>
<hr>
<h2>Products Pages</h2>
<p>For the products page I went for a similar design to what was presented in the tutorial expect with my own twist to it. The 4, 3, 2, 1 product display sizes I kept mainly because it would have been the way I did it myself as it is a pretty standard format for most ecommerce sites. As this is the case I started with the project layout as a template and then amended and changed it so it was a different design. Instead of the standard card format I wanted to create it so when it is on computer browser it is the image of the product but when you hover over it displays the product information such as name, price, rating, etc. I didn’t want to use the hr divider per row as that is a complete copy of the product so, instead I placed a divider at the bottom to state to the customer that this is the end of the range of products. When it is on a mobile/tablet view there isn’t an easy way to implement the design I went for as there isn’t a way really for the user to hover over the product so for this view I ended up fully using the card format as it is simple with a neat and professional look. A problem I have encountered with the hover view is if the title hits a certain length it ends the content out of the div so I’ve set a character limit to the title which gives you enough to state what the product is and anything extra can go into the description on the individual product pages. On my javascript project I created a scroll feature that you click on and it takes you to the top of the page. Instead of the one in the practise project I imported this one from my previous project and used that for this feature with some minor changes to it. Regarding the sort box which I imported from the project minus the categories as I believe if the customer wants to find categories they’ll use the navigation bar options instead of the sort box as it makes it clearer cutting it to only those products instead of have to scroll through lists to get to them. I also imported the javascript as it completed the purpose of the sort box. </p>
<hr>
<h3>Product Model</h3>
<p>For the product models like in the tutorial I used to two which were category and product. The Category contains two fields name and friendly name whereas the product model contains name, description, image URL, image file, sku, rating and category imported from the category model. I was thinking of removing the sku but it is good to have as it’s a unique identifier for each product which separates them from the others. I used “UUID4” to auto-generate a sku for each product as I believed it was a better process instead of entering your own sku as human error could create duplicates. They’re all produced to be unique and unable to be changed. Also due to there being a fair amount of categories in my models I also decided to order them by name. Apart from these changes I kept a lot of the original layout as it seems to be a pretty standard model for information in a product database. As the sku’s are auto generated and vary I decided to order the products in the admin by name rather than sku, I felt it made more sense and looked better within the admin this way.</p>
<hr>
<h3>Product Admin</h3>
<p>The “admin.py” for the product app is very simple. Firstly I import the product and category models from the products models. Then we create two classes the first class is the product admin, all I need to do in this class is state the visible form entries you want to appear in the admin to identify the individual admin entries. I selected the name, category, price, rating, image and sku in that order. I also set the order of the products in the backend admin page by name. The next class was the category class which I did the same as before, state which fields I wanted to appear in the backend admin which were the all the fields which are friendly name, and name. The final part of this is registering the admin classes where you use the built in function “admin.site.register()” and in the brackets you state the model and the corresponding admin class so I set two up with product admin and admin as well as category admin and category and then this is done.</p>
<hr>
<h3>Product View</h3>
<p>The product view is the same as the on in the practise project. I used this as it processes the requests on the products page the way I wanted in this site and I looked into alternative routes but this seems to be the most efficient way of doing it. In the view for the products model you first import the model and create a variable which returns all products. This will need to be added to the context which is then pushed back to the products page. Starting with the search bar you first point it to the all products view via its action to look for get requests, the view will check the request if it has the name “search”. If the request comes back blank it will return an error message which is then returned to the products page via a redirect. If the “search” comes with data it will placed in a query via the Q object imported from the Django database models where it will check the name, description and category of the individual products in the products model. You then pass the query into the filter method to filter out the products that match the data. Add this to the context and set the filter variable (query) to none at the start to prevent errors and then this will work. For the individual pages with specific categories assigned you first have to amend the categories href in the html file and pass the individual categories across for each category option in your navigation bar. In the products view you then look for “category” in the request via the “GET” method. If it contains “category” you then split the categories via “,” and then filter the products to only the category names that are listed in the request. Set it to none at the top again so it won’t break any requests which don’t include this search parameter, this will complete this request and it will work within your app now. To get the sort by price and rating categories to work I need to create two more if statements that search for 2 more get parameters which are “sort” and “direction”. Set “sort” and “direction” to none at the top to prevent errors not including these parameters then starting with sort create an if statement checking if the request contains a “sort” parameter. Next I need to create a variable called sortkey from the requested sort variable then set sort to sortkey, you do this preserve the original variable which in this case will be “name”. You first check to see if “name” field is equal to the sortkey then set sortkey to another variable “lower_name”. You then annotate through “lower_name” via “name” which is inside the lower function to make “name” lowercase. Next you check if “direction” is in request. If that is the case set create a variable called direction which is equal to the requested direction. You then check if “direction” is equal to “desc” (descending) if this is the case you do the following to the “sortkey” which will change the order to descending (sortkey = f'-{sortkey}'). After this all you need to do is set “products” to the order of the “sortkey”. This will either be ascending or descending due to the outcome of “sort” putting them in the order of the parameter selected and “direction” changing the direction from ascending if “desc” is passed through. Finally you create variable to pass the sorting method to the template which is placed above the context, then you add this variable to the context which will complete the sorting process for the categories.</p>
<hr>
<h2>Bag Page</h2>
<h3>Bag view</h3>
<p>The bag view consists of various different functions, the first function for this will be the view bag function. Before writing the view I need to add the newly created app to the settings in the main folder so it is aware of the new application. The view bag view is a simple function that just returns the bag’s HTML template to the application. You don’t need to write anything about the items that are contained in the bag here as that will be handled by the “context.py” which stores the context processor. The only additional configuration required to make this work now is adding the URL to the bags “urls.py” which will be returned to the main file URL’s which redirect the movement from the views through the site. The next function in the view is the “add to bag” view. This takes in request and the item ID which is a unique ID generated for each individual product to identify them. Firstly I’ll create a variable which looks for a post request from the products details page containing the quantity of the product they would like to purchase and a URL so when the function is complete it knows where to redirect the app on submission. I also created a variable bag which will be created in the session if there isn’t already one there, this is where the products for purchase will be stored.  I handle the amount with an if statement checking if the item ID is in the bag if not I will add it to the bag; if it is already in the bag I will increment the quantity by the amount posted from the form in the products details page. Once this if statement is complete I’ll push the updated bag into the session with a request after the “if” statement updating the bag contents stored in the web browsers session. On completion of this process the function will process a redirect which will redirect the user on the application back to the redirect URL which will reload the product details page they’re currently on. I then added a URL for this view in the bag’s “urls.py” so it knows when it’s located with the path containing the item ID which it uses to differentiate between the products. The next function is the “adjust bag” view. I copied the “add to bag” view as it is similar in function so we keep the product details, product quantity and session bag variables and remove redirect URL variable as we want to redirect to the shopping bag HTML page for this function. We work this in an “if” statement that checks if the quantity of a specific item is greater than 0 for the bag item the number of that bag item is equal to the quantity. If the item is less than zero we use the built in “pop” function which pops that item out of the bag session removing it from the bag items. After this “if” statement we return this new quantity to the bag by requesting the browser sessions bag to take in the updated information from the “if” statement by making it equal to the “if” statements bag and then redirect them back to the “view bag” view which will load them to the bag.html page. The final view for this page is a delete bag item function. I copied the product variable and bag which is in the previous two functions to identify the product and the location of the session bag. Then I put them in a “try” block with the “pop” function again targeting the item ID so it deletes the correct item identifying it by its unique ID. I then will request the browser session bag takes in the new bag info by setting it equal to the updated bag viable in this try block and then return a HTTP response equalling 200 (successful) as this view will be triggered by a Javascript action. The “try” block is used to try this function and if it works submit it but if it fails you can catch the error in the “except” part of the function. So in the “except” block we set the exception as “e” creating a variable which can be translated to the exact error and return a HTTP response equalling 500 (Failure) to the application. The variable “e” will be used later with the Django function “messages” which can be used to trigger alerts on the template. This is helpful because I can send a message to inform a user of the application why they can’t remove that Item with the variable “e” as the reasoning. I will cover that in the Toasts section of this write up.</p>
<hr>
<h3>Context Processor</h3>
<p>The context processor as in the practise project was stored in the Bag app as “context.py”. The purpose of the context processor was store useful information that is required throughout the application such as the bag contents and the grand total of the products. To make this work you need to add this context processor to the list on context processors within the “setting.py” of the main application in this case “Mad_hatter”. The way this is designed firstly I created an empty bag list, total (price) and product count initialised as empty and 0 for the starting point of the function. Another variable that will be required is the bag contents itself which we access via a get session request from the browsers session, if there isn’t one already it will create an empty dictionary in the session to store the bag content. The first part of this function handles the bag with a “for” loop. The way it works is for each unique item (identified by its ID) and it’s quantity from the data stored in the in the browsers session items it will then get that data storing it in a variable called product. This is done for each individual item. Then get the quantity and the price of the item multiplying then and storing them a variable called total. This will also add the quantity of the product to the product count keeping the total amount of items up today. You also need to create a dictionary to append the unique ID, quantity and product model (located in the product app) and append that dictionary to the empty bag items variable created at the start. Next is an “if” statement calculates the current bag total price seeing if it hits the free delivery threshold. If it is less than the threshold which is $30 it will calculate 10% of the bag total and add it additionally to the total as the delivery price. If they are below the threshold there is another variable in this if statement that calculates the remaining amount needed to get free delivery which will be used to inform the user what they need to get free delivery. If the amount exceeds the threshold it will set both the delivery charge and the delivery remaining variables to 0 as there are eligible for free delivery. The next part of the function calculates the grand total of their bag. It does this by adding the delivery and total this is stored in the variable (grand_total). Then the context which will be returned to the application will contain the bag items, total, product count, delivery, free delivery threshold, free delivery remainder and grand total.</p>
<hr>
<h2>Checkout Page</h2>
<h3>Checkout Model</h3>
<p>The checkout model consists of two models which are Order and Order line item. Starting with order this one has a lot of fields and most are different to others. Starting with the CharField which are the character fields which are full_name, phone_number, postcode, town_or_city, street_address1, street_address2, county and stripe_pid. All these except as street_address2 were set to required with null and blank equalling false with as well as other fields such as max length varying from each CharField limiting the amount of characters suitably for each variable. Order_number is also a CharField but this is different from the others as isn’t editable and instead a function later on generates a unique string for it with the UUID import that was also used to create the sku for the products model. There is a special field imported from a module called CountryField. The name of this field is country. This is required later on when setting up stripe payments allowing a selection box for the countries in the selection form instead of a standard text, this field has a label field which when this entry is populated on the form it will act as a placeholder name. For email there is an EmailField which is set required by using null and blank equalling false again. There is a DateTimeField which is for the date and has a special entry called “auto_now_add” which is set to true and this generates an up to date, date and time for the order. Finally we have three DecimalFields which are for delivery_cost, order_total and grand_total. They all have null equalling false so they can’t be blank, 2 decimal places allowed there defaults being set to 0 and the max digits equalling 10 for order and grand total but for delivery it is set to 6. The final field in this model is original_bag which is used in Stripe also, this is set to a TextField with null and blank equal to false and default as blank. The first model function was the generate order number by UUID, all it does is simply return a randomly generated string which will be accessed later and placed into the order_number field. The next function is to update the grand total, this function takes in self as an argument. I did this by setting order_total to equal “lineitems.aggregate()” the aggregate function takes in another function called sum which is imported from Django models. The Sum() function takes in lineitem_total which is a variable that is defined in another model for the second checkout model which will be called “OrderLineItem”. This variable takes in the specific cost for the individual line item. The “lineitems” is also found in the second model as a related name for the “order” field. This function will go through each line item in the order and take the “lineitem_total” and add them all together to get the total of all the items in the current order. After that the default behaviour is to add a new field to the query set called “lineitem_total__sum” which we can then access and the order_total will take that in which will provide the correct order total of the products. This still doesn’t take in the delivery threshold and if below the cost so I use an “if” statement checking if the order total is less than the free delivery threshold variable which in the project level settings folder. It is less than that threshold the delivery_cost will equal the order_total multiplied by the standard delivery percentage which is also located in the project level settings folder and then you divide it by 100 which will set the delivery percentage to 10% of the total order cost. If the order_total is more than the free delivery threshold set the delivery cost to 0. With all this done we can now calculate the grand_total by adding the order total and delivery cost then saving the function. At the end of this the fields in the model delivery_cost, order_total and grand_total will have been calculated and filled in. final thing to do is the standard string method which in this case will return the order number for the order model. The final function for this model is a save function to override the original save method if there isn’t an order_number, this takes in self, *args (arguments) and **kwargs (key word arguments). We use an “if” statement in this function to check if it has an order number, if it doesn’t it will use the generate order number function to equal the order_number generating a unique number for it.  Once the order number has been generated it’ll execute the original save method. The second and final Model in the Checkout is a lot smaller as it only consists of 4 fields. The first 2 fields are “Foreignkey” fields as it takes in foreign data. The first one is called order which takes in the order model which is also created in this models.py file, null and blank are set to false as they can’t be blank as well as the related name being set to “lineitems” and on delete it is set to cascade which will also delete any related of referenced objects to it. The second Foreignkey takes in the product model which is located in the models.py of the products app folder. This is also set to null and blank equalling false and on delete equal to cascade.  The next field is an “IntegerField” called quantity set to false for blank and null with a default value of 0. The final field is a “DecimalField” called lineitem_total with a max length of 6 max decimal of 2 and false for null, blank and editable. You can’t edit this as there is a function to calculate the value. To calculate the lineitem_total I did the following. Firstly I temporary override the default save function to run the calculation. The next part is to set lineitem_total to equal the product price which is accessed from the products model and multiplied by the quantity of the product. Once this has been done we can save the model returning the lineitem_total value to the model. 	To wrap it up we use the standard string method to return the sku of the product as well as the order number its part of for each line item.</p>
<hr>
<h3>Checkout Admin</h3>
<p>For the admin I first need to import the Order and OrderLineItem from the checkouts model.py. The first class created is for the OrderLineItem model and it will inherit from “admin.TabularInline”. We use this as it allows us to add and edit line items from inside the order. We set the model for this class to the OrderLineItem model and set a read-only field which will be for the lineitems making them unable to be edited. This is all that needs to be done for this class. The second class is the “OrderAdmin”. The first thing we set is the “inlines” option to equal the OrderLineItem so the inline editable fields will appear on the order admin page. I set the following fields to read-only which are order_number, date, delivery_cost, order_total, grand_total, original_bag and stripe_pid. I then set the format of the fields to be displayed in the model which are all of the above as well as full_name, email, phone_number, country, postcode, town_or_city, street_address1, street_address2 and county. The list to display will be set to order_number, date, full_name, order_total, delivery_cost and grand_total. The orders will be ordered by date start with latest at the top. This is done by setting the ordering field to “-date” inverting the order from oldest to newest to instead newest to oldest. I then need to register the admin to the related model by using “admin.site.register” and providing the Order from the model and the Order admin from this file.</p>
<hr>
<h3>Checkout Signals</h3>
<p>This is used to call the update total function in the checkout model “Order” each time a line item is added to the order. I created a file in the checkout app called signals.py and firstly I imported “post_save” and “post_delete” from “django.db.models.signals” and import receiver from “django.dispatch”. I will also need to import the OrderLineItem model from the checkout models as this is designed to update the lineitem_total within that model. I create a receiver which takes in the post_save function and a sender being the OrderLineItem model. I then create a function called “update_on_save” this takes in sender, instance, created and **kwargs. Sender refers to OrderLineItem which is sending the signal, the instance of the model that sent it, created were Django checks if this a new instance or one being updated and any keyword arguments within this signal. After this all you need to do is call the update total function with “instance.order.update_total()”. The first part is the order this line item in the signal it related to then it calls the function update_total. For a delete signal I have an almost identical function but instead of “post_save” in the receiver I have “post_delete” I change the name of the function to “update_on_delete” and I remove the created argument from the function as nothing is being created in this signal. Everything else is the same and this will listen out for delete signals and update the total accordingly relating to the lineitems removed from the bag. Django won’t automatically realise there are signals implemented in the app, you need to let it know there are. The way I did this is in the apps.py in the checkout app. There is a default class in there and I needed to override the ready method with my own which is just an import to signals.py which make sure any amendments to the order will trigger the signals.</p>
<hr>
<h3>Checkout Form</h3>
<p>In “forms.py” I make changes and amendments to the checkout form which will be used on checkout.html. Firstly I import forms from Django and the order model from the checkout apps “order.py”. I then create a class called “OrderForm” then set up the meta data which is telling the class the form it’s associating with the order model and the fields from that form it will display which are: full_name, email, phone_number, street_address1, street_address2, town_or_city, postcode, country and county. As it knows the model and the fields it’s taking in I started making the changes to the form. To modify attributers of the class I create an inner class called “__init__” which takes in self, *args and **kwargs. Then use the super method to override the auto-generated labels for the class and setup my own. Within the super init function I create a dictionary called placeholders for all the fields previously referenced and provide them if more fitting placeholder names. I then use the self.fields targeting the “full_name” field and setting the attribute autofocus to true which will set the cursor to start in the full name field when they load the checkout page. I then create a for-loop for the fields which will iterate through all the fields targeted by the class. Firstly we need an if statement which checks if it’s not the country field then it can proceed. We do this as we’ve setup the country field to be a selection box and in the models.py it already has a label setup in the field. Inside that if statement there is another if statement which checks if the field in the model is required and if so get that fields newly create placeholder and add a * letting the user know that this field is a required field to proceed. If it isn’t a required field it will leave the form as it is and this if statement ends. The final part of this is 3 separate actions, the first targeting the individual fields and making sure they have the field attribute placeholder set so the names generated above this populate in the form on the checkouts html page. The next is again target the field attributes but this time I attach a custom CSS class to each field which is “stripe-style-input” so I can customise the style of the fields and since it’s the same class they’ll all follow the same format. Finally I target the fields again setting the default labels too false as the placeholder names will cover the labelling of the individual fields.</p>
<hr>
<h3>Checkout View</h3>
<p>Before I get into the view there is some viable management that needs to be done. In the practise project I setup stripe and added the environment variables into my GitPod variables. I now needed to setup the variables into my main apps settings file so I setup two variables which will be used in the following views and are required to communicate with stripe. I added to the bottom of the settings file “STRIPE_PUBLIC_KEY” and “STRIPE_SECRET_KEY” and pointed them to the environment variables so it will receive the public and private keys from the GitPod environment variables and later in deployment also get them from Heroku’s ones too. I also added “STRIPE_CURRENCY” and set it to USD which is also required for stripe to work. I also need to install the stripe module via pip. For the checkout view this takes in request firstly I need to define the stripe public and private key variables and point them to the respective locations in the main apps settings. Next part of this is an if statement which is looking for a post request, inside the if statement I get the bag from the browser session and set it to a variable called bag so the checkout view now has visibility of the session bag for the customers products to purchase. Then I create the form data variable which is a dictionary containing all the contact and delivery information for the customer. Then I create a variable called order form which equals the model “OrderForm” taking in the form data variable which will post the form data into the order form. After this is another if statement which checks to see if the order form is valid and if it is it’ll save the order form. Inside the “if” statement there is now a for-loop which will iterate through the line items for each individual line item in the customers shopping bag. Then inside a try block I’ll get the individual product item out of the bag via there item ID’s, the set another viable called “order_line_item” which equal the OrderLineItem model taking the order, product and quantity fields from the model. They will all equal there values in the model except quantity which will the item data. Following this variable I will save the “order_line_item” making the changes to the variable permanent for this orders individual item. Inside the exception block I’ll check if the product does not exist it will delete the order and redirect the user bag to the view bag HTML page. At the same intention as the for-loop there will be a session request checking if save-info is in the post request which will be used in the profiles app to save the users information to their profile. Finishing off this if statement there will be a return request which will redirect the user to the checkout success page taking “checkout_success” view which is yet to be created and the order number as arguments loading the user to the checkout success HTML page loading in the users just purchased order summary. Closing off the inner form look there will be an “if” statement that will display a toast message stating there was an error. I covered toasts in the toast section stating how that was implemented and various messages that I used to inform users and admin on changes, purchases, errors etc. Closing off the outer if statement this will also contain a variable called bag taking the browsers session bag. This will only come into play if there isn’t a bag so if there isn’t a bag it will redirect the user to the products page via its view. Next there are some variables set for the stripe which are current bag which equals the bag contents which is imported from the context processor in the bag app which takes in the request performing the math for the total of this current order. We then get that total as a variable equalling the current bags variable grand_total which it will take from the bag contents processor. Stripe total is the next which will take the total round it up and multiply it by 100, this is done as stripe won’t take decimals and the maximum amount of decimals allowed is 2 so this will always work. Stripe.api_key is next and this will equal the stripe_secret_key which is defined at the top and taken from settings in the main app. Finally is the intent which equals the stripe payment intent function imported from stripe which will be set to create and take in the amount which equals the previous stripe total variable and the currency which is the third stripe variable which is also stored in the main projects settings folder. There is another “if” statement then created which is designed to check if an authenticated user is making a purchase. If this is true the try block inside the “if” statement will get the user profiles information via the user profile view requesting the user information. It will then look in the user specific profile for their contact and delivery information and if it’s available it will import it into the order form variable. If the user profile information does not exist it will use the original order form information from the order form in the exception block. Also for people who don’t have profile and are purchasing from the site the else statement on the same indentation as the “if” statement it also use the processed order forms information. To finish this view off we need to set the template which will point to the checkout HTML page and set up the context dictionary which will take the order form, stripe public key and the client secret which will equal the intent (payment intent) with the client secret key verifying the payment with stripe. Finally I added the URL for this in the checkout apps urls.py. The final view for this app is the “checkout_success” view, this will take in request and the order number as arguments. I need to set a couple of variables to start, firstly save_info which is a session request looking for the save-info in the Checkout HTML page seeing if it’s ticked. If so it will be used later to save the users profile information. The next is the order which will get the order view and the recently submitted order number to get the order that was just processed in the order to trigger this view. There are 3 more variables that need to be set now and this will handle the customers email confirmation. The first is the customers email address which it will get from the processed order form, the email subject which is a separate txt file stored in checkout apps template directory and the body of the email which is also stored in the same location. The subject and body variable will take the template locations and order so it can display accurate information of the order. The body will also the contact email which it will get from the main apps settings which is a pre-set email address which is used to let the customer know a way to reach out if there any problems or questions. Next is an “if” statement which checks if the user is authenticated. If this is the case it get the users profile name from the user profiles view in the profiles app attaches it to the order and then saves the order. After this I get import the send_mail function from Django and pass the subject, body, default from email and customer email which it will use to send an accurate order confirmation email to the customer. Finally if the bag is in the session still we delete the bag as this point the order has been completed, setup the template variable pointing at the checkout success and set up the context which only takes in the order. Finally we return the request the template and the context back to the view to complete this and add the URL for this view to the checkouts urls.py and the views for the checkout are complete. The checkout_success view also requires the order_number in the URL path as that is unique to each order so with that in the path it will link the just purchased order and populate the correct information in the checkout success html file.</p>
<hr>
<h2>Profiles Page</h2>
<h3>Profiles Model</h3>
<p>For the profiles we only need one model class, this is only for storing the delivery information for specific users. As its gathering information for delivery I will need the Country field again from so I import that from the countries import to be user later. I also will need from Django auth models an import called users, this is used for identifying individual users registered to this application. Starting on the class it is named “UserProfile” and it contains 8 fields which are user, default_phone_number, default_country, default_postcode, default_town_or_city, default_street_address1, default_street_address2, default_county. Phone number, postcode, town or city, street addresses and county are all character field models, all have unique set max lengths and all have null and blank set to true as this fields aren’t required and are more of an ease of life feature. The user field is an “OneToOneField” taking in the Django user model previously referenced to identify the individual user so this information is change is only applied to this specific user. One to one fields state that only one user can have one profile and a profile can only have one user, solidifying the one to one relationship between the two objects. Country user the country field which is the import to allow users a selection box of their country instead of typing it in as it could cause issues in the payment system if it’s incorrect.  With all the fields implemented I created the return string method which returns the model to self which is then attached to the username of the specific user in the Django user model. The final part of this model is a signal function to handle the saving and updating of the users information. For this to work I needed to import post_save and receiver functions from Django. At the start I created a receiver which looks for a post_save request coming for the specific user. Below that I created the function which takes in sender, instance, created and **kwargs. Inside this function I use an “if” statement to check if the information has been created. If this is true it creates a user instance which is then saved to the users, user profile. With this model now imported into the Django app I went back to the checkout model and admin and added the users profile to order model and the viewable fields in the Django admin fields for the order. This shows will now state the specific user name of the user profile that submitted the purchase. I ran migrations and everything worked submitted an order and when you view that order in the admin you can see that the user profile is now attached to the order form.</p>
<hr>
<h3>Profiles Form</h3>
<p>The form for profiles is used to add some styling to the form that will be used to update the user’s delivery information form in there profile. For this I needed two imports forms so I can just this one and the user profile model. I started by creating a custom class call user profile form, I started with assigning the Meta data which was assigning the model for this form which is user profile and an exclusion which is the specific user. I then called the __init__ function taking in self *args and **kwargs. I then used the super function to override the default properties setting up placeholder names for each individual field. I created a variable called placeholder which was a dictionary with a list of all the fields and next to then the assigned placeholder for that field. Just like on the checkout phone I setup the auto focus to generate on the first field in this form which was in this case the phone number field. And also like the checkout page I created a for-loop to irritate though all the fields if the field wasn’t country as its setup different with a custom placeholder already. When iterating though each field it checks if the field is a required one and if this is the case it will amend the placeholder and add a * to the end as that is universally recognised as a required icon in this format. If the field isn’t required it will leave the placeholder name as is. At the same indentation as the “if” statement assigning the required icon I assigned the attribute placeholder to the field which At this point will have the adjusted required/unrequired placeholder and assign it to that field. This will iterate through all the fields assigning the new placeholder. At the same indentation as the “if” statement checking if it’s the country field another attribute will be assigned which is a class called profile-form-input as we can adjust the CSS on the fields. Final step is to assign label to false which will remove the Django default label allowing the newly assigned placeholder to work without any possible disruptions from the default layout. This is pretty much identical to the checkouts form so the main reason in doing this is to keep styling consistent and clean throughout the app.</p>
<hr>
<h3>Profiles View</h3>
<p>For the profiles views, it consists of 3 different views which are the profile page, order page and the order history return. As these pages can only be accessed by authenticated users I lock this down with a special decorated. The decorator is called @login_required and as in its name you have to be logged in/authenticated to access the pages attached to the view. Starting with the profile view placing the login decorator in front of it making it an authenticated only access view. This view only takes in requests as an argument. Importing the user profile model from the profiles models I created a variable which gets the specific user from the one to one field in the user profile model calling it profile. Next part is an “if” statement that looks for a post request method, if the method is post it is set to a variable called form. This variable is equal to the user profile form that takes in the posted information and an instance that is set to profile. This will attach the recently submitted form data containing delivery information to the specific user that is logged in. Next is another “if” statement which checks if the form submitted is valid which if it is, it’ll save the form data. If it isn’t a valid form it will display an error message but this isn’t likely to happen unless they’ve entered information incorrectly as all the fields are set to not required, as it’s an ease of life feature. Going back to the first if statement on the same indentation as that if the method isn’t post it’ll just provide the user profile form with the user’s being taken by the form which will display what has already been posted for that user or blank if there hasn’t been anything saved. The last part of this view contains a variable called template which is where I want the view to point which is the profile page and the context which only takes in the form variable. I then return the template and context to the view as a request to finish this view off. The second view is the order page view. This view has the login required decorator in front as this page should only be accessed by authenticated users. This view is named order page and only takes in to variables which are profile which is the same as the first view getting the specific user from the user profile model and a variable called orders which takes all the orders attached to that specific user. I then create the context which only takes in the orders variable then return the template and context back to the view as a request. The purpose of adding the orders to the context for this view is so the html file can display the information for the users’ specific orders. The final view is called order history and it takes in request and order_number. I imported the order form for this from the checkout model and created a variable called order which gets the order model and order number from within that view. I then set the template for this to the checkout success html page in the checkout app and created the context which takes in the order variable and a special variable called from_order which is equal to true. The from_order variable interacts with an “if” statement on the checkout page which will change the text and link of a button making it more suited for this situation. I then return the template and context back to the view as a request and it is complete. To finalise these I added the URLs for them in urls.py. The first two views required normal URL setups having a standard path and name but of order history path it also needs to contain the order_number. This is required as the order number is unique to each order and is used to identify each order. With this in the path if a user click on the link to their previous order it will display the order as it was displayed when they originally made the purchase and got to the checkout success page.</p>
<hr>
<h2>Deployment</h2>
<p>The deployment for this isn’t as simple as previous due to the multiple moving parts in this. Firstly I had to setup the Heroku app so I had somewhere to deploy too, while here I also setup the free postgres database plugin for later use. Next I needed to setup the link to Heroku which I did by logging into Heroku in the command line from GitPod. Before I did that there was some requirements I needed to need for this to work and I already all but two a Procfile which I setup then deployed to Heroku and set a environment variable in Heroku called collect static and set it to false because static files are going to be stored on AWS S3 service. I then moved the all the environment variables from GitPod to Heroku so they were in place so the app had everything it required to function and the private variables stayed private. Next step was to move the models to Heroku, I removed my default database settings and changed them to point to the postgres database. I saved the settings file and ran migrations which uploaded the models to the postgres database. Final thing to do here was setup a super user for Heroku which was identical to the one in GitPod. Since this was completed I setup an if statement which checked to see if there was a database URL in the environment variables which if there was use that as the database for the app else use the default Django settings. The Database URL will only be in the Heroku app so this will keep both GitPod and Heroku functioning as intended. For this to work successfully you need to install two more requirements which were DJ database URL and psycopg2-binary which is what is used to handle the postgres database link. The final part to this to setup the AWS configuration. To start I setup and logged into AWS, I then went to the S3 Storage section on the site which is where I setup a bucket for the app. Once the bucket was created I then navigated to another service in AWS called IAM which is where I needed to setup the user for the bucket. The next step to this is create a group which all I needed to do was name it. I then created a policy which will be assigned to the group which only provides full access to the S3 bucket which was created for this app. Final step of this is to create and assign a user to the group. Was the user was setup and attached to the group I downloaded the CSV file which contains the access information for the user which is required to authenticate this service within the app. This is all the external setup required to make this work now I needed to update the settings file again to setup some variables to communicate these services. Firstly I installed two more modules via pip3 named boto3 for the S3 services and Django-Storages, these are required for successful connection between AWS and Django. The next thing I setup was the bucket access to the app. I needed 5 variables to do this which are the name of the bucket, the region which the bucket has been assigned to, the access and secret access key which is from the users CSV file and finally the S3 custom domain which is the bucket name plus the s3 services location domain. I stored the access and secret access key in the environment variables to keep then secret and linked then to the page. These are all placed in an If statement which checks for a Variable called Use AWS which will only be in the Heroku application and set to true. Before I imported the next variables I created I python file called custom_storages.py in that file I imported the main project settings and the S3Boto3Storage which I got from the Boto3 Module. I create two classes in here one for static files and one for media. I create two classes first being called StaticStorage and the second being named MediaStorage, they both take in the argument S3Boto3Storage. All I need to do now for these classes is assign a location which will be defined in the main project settings file, once done I saved and went back to the settings. In settings I create 6 more variables which are static files storage, static files location, media files storage, media files location, Static_URL and Media_URL. Static and media files storage point to the custom storage files classes and the static location points to static whereas media location points to media. These will be the names of folders within the AWS bucket. The static and media URL is an override for the default static location so instead of pointing to the files within the Django apps static and media folders it points to the AWS services static and media URL’s. With this setup the static files we be stored and provided to Heroku as well as the images and if a new product is added to the Heroku app it will automatically send and store the image in the media file in the AWS bucket. Before committing the changes and pushing them to the Heroku app I removed the collect static = False variable from Heroku so it didn’t block the collection of the files. As I didn’t have my categories and products in a JSON fixture I had manually add all the products again. Due to this I didn’t have to add much to the AWS media file apart from the homepage background images. I setup one more variable in the USE_AWS if statement which was called use AWS S3 Object Parameters, which communicates with the browser and tells it to cache the files. This variable requires an expiry date and a cache control max age to work. With this complete and all the environment variables put into Heroku they website is successfully deployed.</p>
<hr>
<h2>Testing</h2>
<p>For testing I did my own testing and I created a list of questions, some with guides and I sent it through to a friend who has a provisioned an admin account for. Starting with my testing what I did is go through page by page checking with everything was working. Starting with the Navigation bar I checked to see if everything went to its intended locations starting with the site logo and working down. Logo, Accounts bag and all the individual product links went to their expected locations. For the search bar I set it too look for three different things for products which were name, description and category. I tested all of targeted search criteria’s and as expected it was working as expected. Home page was very simple just checked if there was any issues with the rotating background, there wasn’t so I was done with that. Checked the Email submission and sent a test email. The email went thought without any issues. Next I went to the products pages but as I already tested all the links to the pages I also checked the products that appeared on the pages and they were all appearing under the correct categories. I went into a couple of the products checking if it pulled through there information and it did. I added various quantities checking if the add to back settings worked and they did. The selection box wouldn’t let you add 0 or more than 99 products. The keep shopping link took you back to the all products page also. I tested both the edit and delete within product details and the products pages they worked as intended. Sort by box organised the products correctly by the selected selection. On the bag page secure checkout took you to the checkout page. You can modify the amount on this page and remove the products from your back. The keep shopping link returned you to products. If there were multiple products and it exceeded the maximum height of the container they were stored in it would become a scrollable container. Checkout page I first tried submitting an order without required fields and it wouldn’t allow me to process these requests it would it would always flag an error. Adjust bag button took you bag to the bag and all the order information calculated and displayed correctly. Signup and login page links worked. I finally logged in and submitted an order clicking save info using the test stripe card info and the order went through successfully. I then checked my account info and everything had pulled through. I then updated my profile information and went back to the checkout page to see if it changed which it did. I then went to my emails to see if a confirmation email went through and I did receive an email. When I completed the purchase it pulled through the all the correct information and displayed it on the checkout success page. I then did another purchase which was below the free delivery threshold to see if the order would calculate the delivery cost which it did. I went to my orders page next and I could see that all the orders populated there dropdowns worked and displayed the correct information the order summary button took you to the original order and the button redirects you back to the orders page. I then created an account via signup used a temporary email and that worked got the email verified the account and everything worked. I logged out and logged in with this account to double check and then checked the admin to triple check and everything appeared to be in order. I then tested the second login option which was to sign in via google. I tested this and it ran very smoothly and logged me in and populated a social account within the admin. At this point I tested everything and as expected it was working fine. I have a habit of testing something that is just implemented to app as soon as I’ve done it so I was expecting this to be the outcome. I still went through with user tests but due to the current climate and the pandemic it’s hard to organise this type of thing. I tested with a trusted friend who remotely tested it as an admin and user. I will have attached the questions to the GitHub so you can see what he was asked to do. The questions looked very basic but covered everything that was required he came back to me with no problems apart from stripe card entry box wasn’t populating which I asked him to deactivate any blockers on his page which restored the card box to the page. There was one final person I tested this with which was the customer for this app. As the customer is my sister it was very easy to organise we sat down and went over everything previously stated above. After all that they were happy with the produced product which is where the testing ended. </p>
<hr>
<h2>Conclusion</h2>
<p>This Course has been incredible I have learnt so much but there have been some struggles Django being the biggest one of all. I understand how it works, how to get around it and produce application from it but I still need to learn more so in next upcoming months I will continue to learn this framework alongside the over languages taught in this course. I have enjoyed Django and I am content with the file product Produced for my milestone project. The one Disappointment I have from this is I was unable to implement a coupon system for this project. I spend a solid 2 weeks trying to figure it out reached out to my mentor and the tutors but I never managed to complete the feature. I managed to get it working and calculating within the Django app but this would only occur on the bag page and once it changed the price would revert bag to the original undiscounted total. I don’t plan to stop looking into this and figuring out what were the extra steps required to complete this but it’s a shame I couldn’t have it for the milestone project. Overall I am happy with the knowledge and insight I have gained from this course, I have a plan after this course to continue to study and practise the 4 languages taught on this course mainly focusing on Python and Javascript. It has been a great experience and I will keep pushing myself to grow and develop into a proficient Full Stack Developer.</p>
<hr>